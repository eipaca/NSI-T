# Protocoles de routage

##	Couche Internet et adresses IP

###	Modèles OSI et TCP/IP

Communiquer consiste à transmettre des informations, mais tant que les interlocuteurs ne lui ont pas attribué un sens, il ne s'agit que de données et pas d'information. Les interlocuteurs doivent donc non seulement parler un langage commun mais aussi maîtriser des règles minimales d'émission et de réception des données. C'est le rôle d'un protocole.

!!! abstract "Cours" 
    L'ensemble des règles qui permettent à deux machines de communiquer ensemble via un réseau s'appelle un **protocole**.

Afin de s'y retrouver au milieu des protocoles réseaux, les modèles OSI et TCP/IP permettent de les classer selon leurs niveaux d'abstractions, dans ce qu'on appelle des couches. 

!!! abstract "Cours" 
    Une **couche réseau** regroupe un ensemble de protocoles ayant un même niveau d'abstraction ets des fonctionnalités similaires.

Le modèle OSI (*Open Systems Interconnection*) comporte sept couches. Le modèle TCP/IP est plus simple, il ne comporte que quatre couches : Accès au Réseau, Internet, Transport et Application.


![Schéma comparatif des couches dans les modèles OSI et TCP/IP](assets/4-modele-osi-tcp-ip-light-mode.png#only-light)
![Schéma comparatif des couches dans les modèles OSI et TCP/IP](assets/4-modele-osi-tcp-ip-dark-mode.png#only-dark)



###	Couche Accès au Réseau : les adresses MAC

![Une carte réseau Ethernet](assets/4-carte-interface-reseau.png){width="20%" align=right}


Une carte d'interface réseau -- ou carte réseau ou NIC (pour *Network Interface Controller*) -- par exemple une carte Ethernet ou WiFi, possède une adresse unique, appelée **adresse MAC** (*Media Access Control*) qui est donnée par le constructeur de la carte et qui permet de l'identifier de façon unique.

![Adresse MAC d'une machine dans un réseau Filius](assets/4-adresse-mac-machine-filius.png){width="20%" align=left}

L'adresse MAC est constituée de 6 octets écrits sous forme hexadécimale, chacun séparé par " : " (par exemple : `00:13:A9:58:32:EB`). Les 3 premiers octets définissent le constructeur de la carte réseau (ici Sony Corporation), les 3 derniers le numéro de fabrication.




Dans un réseau, un commutateur (ou *switch*) connaît les adresses MAC des machines qui lui sont branchées. 

Les paquets de données envoyés à l'adresse MAC `FF:FF:FF:FF:FF:FF` (adresse *broadcast*) sont envoyés à toutes les machines connectées au réseau. Le protocole ARP (*Address Resolution Protocol*) permet de lier les adresses MAC aux adresses IP correspondantes.

###	Couche Internet : les adresses IP

!!! abstract "Cours" 
    L'adresse IP permet d'identifier une machine sur un réseau. 
    
    Une machine qui possède plusieurs cartes d'interface réseau a plusieurs adresses IP, chaque adresse étant associée à une carte réseau.

Il existe actuellement deux versions du protocole IP: **IPv4 et IPv6** :

![Adresse IPv4 représentée avec des chiffres décimaux et binaires. Source: wikipedia](assets/4-adresse-ipv4-light-mode.png#only-light){width="25%" align=right}
![Adresse IPv4 représentée avec des chiffres décimaux et binaires. Source: wikipedia](assets/4-adresse-ipv4-dark-mode.png#only-dark){width="25%" align=right}

-   La version **IPv4 utilise des adresses 32 bit**s, généralement représentées en notation décimale par 4 octets (prenant les valeurs entre 0 et 255), séparés par des points.  
    
    Exemple d'adresse IPv4 :  `172.16.254.1`.
    
    Le nombre d'adresses IPv4 possibles est de $2^{32} = 256^4 = 4{\space}294{\space}967{\space}296$. Ces adresses sont en cours « d'épuisement », c'est-à-dire qu'il n'y en a plus assez par rapport aux besoins du monde actuel.

![Adresse IPv6 représentée avec des chiffres hexadécimaux et binaires.. Source: wikipedia](assets/4-adresse-ipv6-light-mode.png#only-light){width="25%" align=right}
![Adresse IPv6 représentée avec des chiffres hexadécimaux et binaires.. Source: wikipedia](assets/4-adresse-ipv6-dark-mode.png#only-dark){width="25%" align=right}


-	La version **IPv6 utilise des adresses plus longues de 128 bits**, représentées par 8 champs de 16 bits, délimités par deux points (:). Chaque champ doit contenir un nombre hexadécimal, ou laissé vide quand il est égal à zéro.

    Exemple d'adress IPv6 : `3002:0bd6::::ee00:0033:6778`

    Le nombre d'adresses IPv6 disponibles est de $2^{128}$ c'est-à-dire $3,4 {\times} 10^{38}$  adresses, ce protocole semble donc inépuisable. 

!!! abstract "Cours" 
    L'adresse IP est inséparable de son masque de sous-réseau.  Dans le masque, les bits à 1 représentent la partie réseau de l'adresse IP, les bits à 0 représentent la partie machine. 

Comme le masque de sous-réseau est codé sur 32 bits, voici un exemple possible de masque:

|   |   |   |
|:--|:--|:--|
|   |   |`__________Réseau__________|_Machine`|
|IP|`192.168.1.45`|`11000000.10101000.00000001|00101101` |
|Masque|`255.255.255.0`|`11111111.11111111.11111111|00000000`|
|Réseau|`192.168.1.0`|`11000000.10101000.00000001|00000000`|


Prenons l'exemple d'une machine d'adresse IP `192.168.1.45` avec le masque `255.255.255.0`. Les bits des trois premiers octets du masque sont à `1`, ils donnent la partie « réseau », et les bits suivant à `0` donnent la partie « machine ». 

L'adresse dont tous les bits de la partie machine sont à `0` (`192.168.1.0`) est l'adresse du réseau entier, celle dont tous les bits de la partie machine sont à `1` (`192.168.1.255`) est l'adresse de diffusion qui permet d'envoyer un message sur tout le réseau (appelée « *broadcast* »). Ces deux adresses sont réservées, elles ne peuvent pas être utilisées par une machine. Il reste donc  $2^8 - 2 = 254$ adresses disponibles pour les machines sur le réseau `192.168.1.0`, allant de `192.168.1.1` à `192.168.1.254`. 

- `192.168.1.0`    --> réservée pour l'adresse réseau

- `192.168.1.1`    

- ...

- `192.168.1.254`

- `192.168.1.255` --> réservée pour l'adresse de diffusion (*broadcast*)


Pour des raisons de calcul binaire (les « `1` » du masque sont contigus), les masques de sous réseau ne peuvent prendre que les valeurs suivantes : `0` ; `128` ; `192` ; `224` ; `240` ; `248` ; `252` ; `254` ; `255`.

Une autre notation souvent utilisée, la **notation CIDR**, consiste à noter directement en décimal le nombre de bits `1` du masque à la fin de l'adresse IP. Ainsi `192.168.25.0/255.255.255.0` peut aussi écrire `192.168.25.0/24`, car le masque réseau est sur 24 bits.
De même `10.0.0.0/255.0.0.0` peut aussi s'écrire `10.0.0.0/8` et `192.168.1.192/255.255.255.240` peut s'écrire `192.168.1.192/28`.


Il est facile d'identifier les parties réseau et machine d'une adresse IPv4 quand le masque ne comporte que des 255 et des 0, ou un multiple de 8 en notation CIDR, mais ce n'est pas aussi simple pour les autres valeurs de masque -- `128` ; `192` ; `224` ; `240` ; `248` ; `252` ; `254` -- il faut alors "découper" un octet ! Prenons l'exemple de l'adresse `192.168.1.192/255.255.255.240` ou `192.168.1.192/28` en notation CIDR : 

Prenons l'exemple d'une machine dont l'adresse IP serait `192.168.1.205/255.255.255.240` ou `192.168.1.205/28` :

- L'adresse IP `192.168.1.205` s'écrit en binaire `11000000.10101000.00000001.11001101`. 

- Le masque IP `255.255.255.240` s'écrit en binaire `11111111.11111111.11111111.11110000`. 

Dans ce cas, la partie réseau est déterminée par les 28 premiers bits de l'adresse (ceux qui sont à `1`). Elle est obtenue par un `ET` logique entre l'adresse IP et son masque. Tous les bits de l'adresse qui correspondent à un `1` du masque sont gardés, les autres sont remplacés par des `0` : 

|   |   |`___________Réseau_____________|Machine`|
|:--|:--|:--|
|IP|`192.168.1.205 `|`11000000.10101000.00000001.1100|1101` |
|Masque|`255.255.255.240`|`11111111.11111111.11111111.1111|0000`|
|Réseau|`192.168.1.192`|`11000000.10101000.00000001.1100|0000`|

La partie réseau de l'adresse est donc `11000000.10101000.00000001.11000000` autrement dit `192.168.1.192`. 
Les adresses disponibles sur ce réseau sont donc :

- `11000000.10101000.00000001.1100|0000` c'est-à-dire `192.168.1.192`  --> réservée pour l'adresse réseau

- `11000000.10101000.00000001.1100|0001` c'est-à-dire `192.168.1.193`
- `11000000.10101000.00000001.1100|0010` c'est-à-dire `192.168.1.194`

- ...
- `11000000.10101000.00000001.1100|1101` c'est-à-dire `192.168.1.205`  --> notre machine
- `11000000.10101000.00000001.1100|1110` c'est-à-dire `192.168.1.206`
- `11000000.10101000.00000001.1100|1111` c'est-à-dire `192.168.1.207`  --> réservée pour l'adresse de diffusion (*broadcast*)

Les adresses diponbibles pour les ordinateurs sur ce réseau vont de `192.168.1.193` à `192.168.1.206`, il y en a donc $2^4 - 2 = 14$.

!!! question "Exercice corrigé" 
	On donne l'adress IPv4 d'une machine `192.168.2.60/25`.
    Déterminer l'adresse de ce réseau et les adresses possibles des autres machines sur ce réseau.
        

??? Success "Réponse"
    Ecrivons l'adresse IP en binaire et séparons la partie réseau (les 25 premiers bits) de l apartie machine (les 7 bits suivants) : 

    |   |   |`___________Réseau____________|Machine`|
    |:--|:--|:--|
    |IP|`192.168.2.60 `|`11000000.10101000.00000010.0|0111100` |
    |Masque|25 bits|`11111111.11111111.11111111.1|0000000`|
    |Réseau|`192.168.1.192`|`11000000.10101000.00000010.0|0000000`|
    
    Les adresses disponibles sur ce réseau sont donc :

    - `11000000.10101000.00000010.0|0000000` c'est-à-dire `192.168.2.0` (adresse réseau)
    - `11000000.10101000.00000010.0|0000001` c'est-à-dire `192.168.2.1`
    - `11000000.10101000.00000010.0|0000010` c'est-à-dire `192.168.2.2`
        - ...
    - `11000000.10101000.00000010.0|1111110` c'est-à-dire `192.168.2.126`
    - `11000000.10101000.00000010.0|1111111` c'est-à-dire `192.168.2.127` (adresse de diffusion (*broadcast*)) 

    L'adresse du réseau est `192.168.2.0/25`.

    Il y a $2^7 - 2 = 126$ adresses machine disponibles, allant de `192.168.2.1` à `192.168.2.126`.

